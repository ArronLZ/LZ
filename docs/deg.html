<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 RNAseq差异分析 | LZ 文档</title>
  <meta name="description" content="本包致力于简化生信分析流程和批量分析。目前主要为RNAseq分析流程，后期会 加入多组学联合分析流程。" />
  <meta name="generator" content="bookdown 0.36 and GitBook 2.6.7" />

  <meta property="og:title" content="2 RNAseq差异分析 | LZ 文档" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="本包致力于简化生信分析流程和批量分析。目前主要为RNAseq分析流程，后期会 加入多组学联合分析流程。" />
  <meta name="github-repo" content="ArronLZ/LZ" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 RNAseq差异分析 | LZ 文档" />
  
  <meta name="twitter:description" content="本包致力于简化生信分析流程和批量分析。目前主要为RNAseq分析流程，后期会 加入多组学联合分析流程。" />
  

<meta name="author" content="作者：荔枝 earth_farmer@outlook.com" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="install.html"/>
<link rel="next" href="enrich.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">LZ 文档</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>前言</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#为何阅读本书"><i class="fa fa-check"></i>为何阅读本书</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#本书结构"><i class="fa fa-check"></i>本书结构</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#致谢"><i class="fa fa-check"></i>致谢</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="install.html"><a href="install.html"><i class="fa fa-check"></i><b>1</b> 安装</a></li>
<li class="chapter" data-level="2" data-path="deg.html"><a href="deg.html"><i class="fa fa-check"></i><b>2</b> RNAseq差异分析</a>
<ul>
<li class="chapter" data-level="2.1" data-path="deg.html"><a href="deg.html#deg-mian"><i class="fa fa-check"></i><b>2.1</b> 差异分析</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="deg.html"><a href="deg.html#加载包"><i class="fa fa-check"></i><b>2.1.1</b> 加载包</a></li>
<li class="chapter" data-level="2.1.2" data-path="deg.html"><a href="deg.html#数据准备"><i class="fa fa-check"></i><b>2.1.2</b> 数据准备</a></li>
<li class="chapter" data-level="2.1.3" data-path="deg.html"><a href="deg.html#文件夹准备"><i class="fa fa-check"></i><b>2.1.3</b> 文件夹准备</a></li>
<li class="chapter" data-level="2.1.4" data-path="deg.html"><a href="deg.html#差异分析预设置"><i class="fa fa-check"></i><b>2.1.4</b> 差异分析预设置</a></li>
<li class="chapter" data-level="2.1.5" data-path="deg.html"><a href="deg.html#差异分析"><i class="fa fa-check"></i><b>2.1.5</b> 差异分析</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="deg.html"><a href="deg.html#deg-valcano"><i class="fa fa-check"></i><b>2.2</b> 火山图</a></li>
<li class="chapter" data-level="2.3" data-path="deg.html"><a href="deg.html#热图"><i class="fa fa-check"></i><b>2.3</b> 热图</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="enrich.html"><a href="enrich.html"><i class="fa fa-check"></i><b>3</b> 富集分析</a>
<ul>
<li class="chapter" data-level="3.1" data-path="enrich.html"><a href="enrich.html#enrich-auto"><i class="fa fa-check"></i><b>3.1</b> GO &amp; KEGG 富集分析</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="enrich.html"><a href="enrich.html#一键脚本批量处理"><i class="fa fa-check"></i><b>3.1.1</b> 一键脚本(批量处理)</a></li>
<li class="chapter" data-level="3.1.2" data-path="enrich.html"><a href="enrich.html#enrich-simple"><i class="fa fa-check"></i><b>3.1.2</b> 简易GO,KEGG一次分析</a></li>
<li class="chapter" data-level="3.1.3" data-path="enrich.html"><a href="enrich.html#dotplot"><i class="fa fa-check"></i><b>3.1.3</b> GO、KEGG分析结果可视化 {#enrich-visual}</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="enrich.html"><a href="enrich.html#enrich-gsea"><i class="fa fa-check"></i><b>3.2</b> GSEA分析</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="enrich.html"><a href="enrich.html#r-gsea"><i class="fa fa-check"></i><b>3.2.1</b> R GSEA</a></li>
<li class="chapter" data-level="3.2.2" data-path="enrich.html"><a href="enrich.html#gsea官方软件"><i class="fa fa-check"></i><b>3.2.2</b> GSEA官方软件</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="visual.html"><a href="visual.html"><i class="fa fa-check"></i><b>4</b> 差异及富集分析可视化专题</a></li>
<li class="chapter" data-level="5" data-path="rnaseq-rsubread.html"><a href="rnaseq-rsubread.html"><i class="fa fa-check"></i><b>5</b> RNAseq上游流程</a></li>
<li class="chapter" data-level="6" data-path="multi-omics.html"><a href="multi-omics.html"><i class="fa fa-check"></i><b>6</b> 多组学</a></li>
<li class="chapter" data-level="7" data-path="cuttag.html"><a href="cuttag.html"><i class="fa fa-check"></i><b>7</b> CUT&amp;TAG</a></li>
<li class="chapter" data-level="8" data-path="scRNA.html"><a href="scRNA.html"><i class="fa fa-check"></i><b>8</b> 单细胞分析</a></li>
<li class="chapter" data-level="9" data-path="spatial.html"><a href="spatial.html"><i class="fa fa-check"></i><b>9</b> 空间转录组</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Edited by LZ <br> Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">LZ 文档</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="deg" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> RNAseq差异分析<a href="deg.html#deg" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="deg-mian" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> 差异分析<a href="deg.html#deg-mian" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="加载包" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> 加载包<a href="deg.html#加载包" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="deg.html#cb2-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>());<span class="fu">gc</span>()</span>
<span id="cb2-2"><a href="deg.html#cb2-2" tabindex="-1"></a><span class="fu">library</span>(LZ)</span>
<span id="cb2-3"><a href="deg.html#cb2-3" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb2-4"><a href="deg.html#cb2-4" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb2-5"><a href="deg.html#cb2-5" tabindex="-1"></a><span class="fu">library</span>(DESeq2)</span>
<span id="cb2-6"><a href="deg.html#cb2-6" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb2-7"><a href="deg.html#cb2-7" tabindex="-1"></a><span class="fu">library</span>(BiocParallel)</span>
<span id="cb2-8"><a href="deg.html#cb2-8" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-9"><a href="deg.html#cb2-9" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot; 您电脑线程为:&quot;</span>, <span class="fu">detectCores</span>())</span>
<span id="cb2-10"><a href="deg.html#cb2-10" tabindex="-1"></a><span class="co"># 如果是12代以后的interCPU,建议最高不超过6或8。服务器可加大设置，但不能大于线程总数。</span></span>
<span id="cb2-11"><a href="deg.html#cb2-11" tabindex="-1"></a><span class="co"># 此处如果电脑性能一般，建议直接使用n=4或者2。</span></span>
<span id="cb2-12"><a href="deg.html#cb2-12" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">4</span></span>
<span id="cb2-13"><a href="deg.html#cb2-13" tabindex="-1"></a><span class="co"># register(MulticoreParam(n)) 苹果和linux电脑使用这句替代下句</span></span>
<span id="cb2-14"><a href="deg.html#cb2-14" tabindex="-1"></a><span class="fu">register</span>(<span class="fu">SnowParam</span>(n))</span></code></pre></div>
</div>
<div id="数据准备" class="section level3 hasAnchor" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> 数据准备<a href="deg.html#数据准备" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>RNAseq下游分析必须准备两个文件：表达矩阵表格文件，分组表格文件<br>
将gene_count.csv，group.csv放在工作目录下<br></p>
<ul>
<li>gene_count.csv 矩阵数据格式(数值型，整型)</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="left">ID</th>
<th align="left">row1</th>
<th align="left">row2</th>
<th align="left">row3</th>
<th align="left">row4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gene1</td>
<td align="left">34</td>
<td align="left">23</td>
<td align="left">56</td>
<td align="left">23</td>
</tr>
<tr class="even">
<td align="left">gene2</td>
<td align="left">35</td>
<td align="left">23</td>
<td align="left">12</td>
<td align="left">23</td>
</tr>
<tr class="odd">
<td align="left">gene3</td>
<td align="left">12</td>
<td align="left">78</td>
<td align="left">78</td>
<td align="left">78</td>
</tr>
</tbody>
</table>
<ul>
<li>group.csv 分组数据格式：需要组的行名 包含于 表达谱的列名 rownames(group) %in% colname(eset)</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="left">Sample</th>
<th align="left">Type</th>
<th align="left">BATCH</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">rowname1</td>
<td align="left">tumor</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">rowname2</td>
<td align="left">tumor</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">rowname3</td>
<td align="left">normal</td>
<td align="left">2</td>
</tr>
<tr class="even">
<td align="left">rowname4</td>
<td align="left">normal</td>
<td align="left">2</td>
</tr>
</tbody>
</table>
<ul>
<li>注意：<br>
表达文件中的基因名是SYMBOL还是ESembleID。如为EsembleID,要注意是有小数点的ID还是没有小数点的。
有小数点的形式为这样：ESEM00000123.34，没有点的是ESEM00000123。<br>
还有记住基因名这列的列名，建议统一设置为ID。<br></li>
</ul>
</div>
<div id="文件夹准备" class="section level3 hasAnchor" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> 文件夹准备<a href="deg.html#文件夹准备" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>本文中有时也将文件夹称为目录，这两者等价。建议每个项目新建一个文件夹，例如本项目新建了一个名为
LZexample的文件夹，然后再在这个文件夹下建了一个data文件夹，以后data目录专门用来存原始文件，例
如RNAseq分析所需的eset.csv, group.csv或者更加原始的文件。<br></p>
<p><strong>目录结构建议</strong>：本项目的目录初始结构，建议每个项目按着这个形式来。项目文件夹LZexample这个文
件夹名建议改成有意义的名称，一眼便能看出这个项目是什么数据或者什么目的，而data文件夹名不建议更改。
图片</p>
</div>
<div id="差异分析预设置" class="section level3 hasAnchor" number="2.1.4">
<h3><span class="header-section-number">2.1.4</span> 差异分析预设置<a href="deg.html#差异分析预设置" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="deg.html#cb3-1" tabindex="-1"></a><span class="co"># 设置工作目录，即之后所有的操作如果不指定文件夹，都将会在这个文件夹下进行</span></span>
<span id="cb3-2"><a href="deg.html#cb3-2" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;C:/data/LZexample&quot;</span>)  <span class="co"># 按需更改成你的项目文件夹</span></span>
<span id="cb3-3"><a href="deg.html#cb3-3" tabindex="-1"></a><span class="fu">getwd</span>() <span class="co"># 检查是否更改工作目录成功了？</span></span>
<span id="cb3-4"><a href="deg.html#cb3-4" tabindex="-1"></a><span class="co"># Windows系统下默认的文件夹路径是 &quot;C:/data/LZexample&quot; 这中斜杆分隔文件夹，</span></span>
<span id="cb3-5"><a href="deg.html#cb3-5" tabindex="-1"></a><span class="co"># 如果是直接从win复制而来的，请将斜杠\改成反斜杠/, 就如下面设置的这样。（改成\\也行）</span></span>
<span id="cb3-6"><a href="deg.html#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="deg.html#cb3-7" tabindex="-1"></a><span class="co"># 设置此次分析的标记</span></span>
<span id="cb3-8"><a href="deg.html#cb3-8" tabindex="-1"></a>mark <span class="ot">&lt;-</span> <span class="st">&quot;T_C&quot;</span>  <span class="co"># 此次分析的标记(记录谁比谁或和筛选阈值，建议设置的有意义)</span></span>
<span id="cb3-9"><a href="deg.html#cb3-9" tabindex="-1"></a><span class="co"># 设置结果输出的文件夹，按需设定，可保持默认，如果修改只修改此处即可，下面无需修改。</span></span>
<span id="cb3-10"><a href="deg.html#cb3-10" tabindex="-1"></a><span class="co"># 第一次分析可以不用改，但如是第二分析，必须改这个，否则会覆盖第一次的结果。</span></span>
<span id="cb3-11"><a href="deg.html#cb3-11" tabindex="-1"></a>outdir <span class="ot">&lt;-</span> <span class="st">&quot;result&quot;</span>  </span>
<span id="cb3-12"><a href="deg.html#cb3-12" tabindex="-1"></a>outdirsub <span class="ot">&lt;-</span> <span class="fu">paste0</span>(outdir, <span class="st">&quot;/&quot;</span>,mark)</span>
<span id="cb3-13"><a href="deg.html#cb3-13" tabindex="-1"></a>outdirsub.gsea <span class="ot">&lt;-</span> <span class="fu">paste0</span>(outdirsub, <span class="st">&quot;/gsea&quot;</span>)</span>
<span id="cb3-14"><a href="deg.html#cb3-14" tabindex="-1"></a>outdirsub.rich <span class="ot">&lt;-</span> <span class="fu">paste0</span>(outdirsub, <span class="st">&quot;/rich&quot;</span>)</span>
<span id="cb3-15"><a href="deg.html#cb3-15" tabindex="-1"></a><span class="co"># 差异分析阈值设定</span></span>
<span id="cb3-16"><a href="deg.html#cb3-16" tabindex="-1"></a>ffdr <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb3-17"><a href="deg.html#cb3-17" tabindex="-1"></a>fpval <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb3-18"><a href="deg.html#cb3-18" tabindex="-1"></a>flogfc <span class="ot">&lt;-</span> <span class="dv">1</span></span></code></pre></div>
</div>
<div id="差异分析" class="section level3 hasAnchor" number="2.1.5">
<h3><span class="header-section-number">2.1.5</span> 差异分析<a href="deg.html#差异分析" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="deg.html#cb4-1" tabindex="-1"></a><span class="co"># 读取并整理数据（如果都是按照上面的要求来的，不需要改这里的参数）</span></span>
<span id="cb4-2"><a href="deg.html#cb4-2" tabindex="-1"></a>glist <span class="ot">&lt;-</span> <span class="fu">DEG_prepareData</span>(<span class="at">eset_file =</span> <span class="st">&quot;data/eset.csv&quot;</span>, <span class="co"># 表达数据的相对路径</span></span>
<span id="cb4-3"><a href="deg.html#cb4-3" tabindex="-1"></a>                         <span class="at">group_file =</span> <span class="st">&quot;data/group.csv&quot;</span>, <span class="co"># 分组文件的相对路径</span></span>
<span id="cb4-4"><a href="deg.html#cb4-4" tabindex="-1"></a>                         <span class="at">id_dot =</span> F,  <span class="co"># ESEM是否有点，有点设为T</span></span>
<span id="cb4-5"><a href="deg.html#cb4-5" tabindex="-1"></a>                         <span class="at">col.by =</span> <span class="st">&quot;ID&quot;</span>,  <span class="co"># 基因名列的列名</span></span>
<span id="cb4-6"><a href="deg.html#cb4-6" tabindex="-1"></a>                         <span class="at">annot_trans =</span> F, <span class="co"># 是否要注释，如果是EsembleID就需要设置为T</span></span>
<span id="cb4-7"><a href="deg.html#cb4-7" tabindex="-1"></a>                         <span class="at">f_mark =</span> mark)</span>
<span id="cb4-8"><a href="deg.html#cb4-8" tabindex="-1"></a></span>
<span id="cb4-9"><a href="deg.html#cb4-9" tabindex="-1"></a><span class="co"># 差异分析 deseq2三部曲</span></span>
<span id="cb4-10"><a href="deg.html#cb4-10" tabindex="-1"></a>dds <span class="ot">&lt;-</span> <span class="fu">DEG_DESeq2.dds</span>(<span class="at">exprset.group=</span>glist, <span class="at">batch =</span> F)</span>
<span id="cb4-11"><a href="deg.html#cb4-11" tabindex="-1"></a><span class="fu">DEG_DESeq2.pca</span>(dds, <span class="at">outdir =</span> outdirsub) <span class="co"># 此处有warning信息，不用管。</span></span>
<span id="cb4-12"><a href="deg.html#cb4-12" tabindex="-1"></a>dds_list <span class="ot">&lt;-</span> <span class="fu">DEG_DESeq2.ana</span>(dds)</span>
<span id="cb4-13"><a href="deg.html#cb4-13" tabindex="-1"></a></span>
<span id="cb4-14"><a href="deg.html#cb4-14" tabindex="-1"></a><span class="co"># 差异后分析</span></span>
<span id="cb4-15"><a href="deg.html#cb4-15" tabindex="-1"></a><span class="cf">if</span> ( <span class="fu">dir.exists</span>(outdirsub.gsea) ) {</span>
<span id="cb4-16"><a href="deg.html#cb4-16" tabindex="-1"></a>  <span class="co"># 如果outdirsub.gsea文件夹存在，清空该文件夹下所有文件</span></span>
<span id="cb4-17"><a href="deg.html#cb4-17" tabindex="-1"></a>  <span class="fu">file.remove</span>(<span class="fu">list.files</span>(outdirsub.gsea, <span class="at">full.names =</span> T))</span>
<span id="cb4-18"><a href="deg.html#cb4-18" tabindex="-1"></a>}</span>
<span id="cb4-19"><a href="deg.html#cb4-19" tabindex="-1"></a><span class="co"># 构建GSEA官网软件分析所需格式文件</span></span>
<span id="cb4-20"><a href="deg.html#cb4-20" tabindex="-1"></a><span class="fu">DEGres_ToGSEA</span>(<span class="at">diffan.obj =</span> dds_list, <span class="at">outdir =</span> outdirsub.gsea) <span class="co"># 此处有warning，不用管。</span></span>
<span id="cb4-21"><a href="deg.html#cb4-21" tabindex="-1"></a><span class="co"># all_father中记录了</span></span>
<span id="cb4-22"><a href="deg.html#cb4-22" tabindex="-1"></a><span class="co">#             差异分析的总表，默认阈值的差异基因表，</span></span>
<span id="cb4-23"><a href="deg.html#cb4-23" tabindex="-1"></a><span class="co">#             上调基因列表，下调基因列表</span></span>
<span id="cb4-24"><a href="deg.html#cb4-24" tabindex="-1"></a><span class="co">#             以及R-GSEA分析所需要的所有mRNA的表达排序列表。</span></span>
<span id="cb4-25"><a href="deg.html#cb4-25" tabindex="-1"></a><span class="co">#   是我们后续各种分析的万恶之源（因此命名all_father）</span></span>
<span id="cb4-26"><a href="deg.html#cb4-26" tabindex="-1"></a><span class="co">#   上述数据同时被保存在本地硬盘的到一个多sheet的xlsx表中【outdirsub.rich目录中】</span></span>
<span id="cb4-27"><a href="deg.html#cb4-27" tabindex="-1"></a>all_father <span class="ot">&lt;-</span> <span class="fu">DEGres_ToRICH</span>(<span class="at">diffan.obj =</span> dds_list, <span class="at">p=</span>fpval, <span class="at">q=</span>ffdr, <span class="at">f=</span>flogfc,</span>
<span id="cb4-28"><a href="deg.html#cb4-28" tabindex="-1"></a>                            <span class="at">mark=</span>mark, <span class="at">outdir =</span> outdirsub.rich)</span>
<span id="cb4-29"><a href="deg.html#cb4-29" tabindex="-1"></a><span class="fu">save.image</span>(<span class="at">file =</span> <span class="fu">paste0</span>(outdirsub, <span class="st">&quot;/1.diff.img.RDATA&quot;</span>)) <span class="co"># 保存中间数据</span></span></code></pre></div>
</div>
</div>
<div id="deg-valcano" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> 火山图<a href="deg.html#deg-valcano" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>需要修改的是以下几个值：<br/>
df_valcano：文件读取时的文件路径<br/>
ffdr: FDR阈值<br/>
fpval: PValue阈值<br/>
flogfc: logFC阈值<br/>
filterc: 火山图展示模式(p,fdr均考虑模式, 仅考虑p值模式，仅考虑fdr值模式，默认为第一种”fppadj”)<br/>
label_gene: 展示基因列表<br/>
不清楚建议默认：fdr=0.1, pval=0.05, p,fdr均考虑模式。仅修改<code>label_gene: 展示基因列表</code>即可。</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="deg.html#cb5-1" tabindex="-1"></a><span class="co"># 本流程中不需要运行，后续想再次分析时可从此步开始</span></span>
<span id="cb5-2"><a href="deg.html#cb5-2" tabindex="-1"></a><span class="co"># load(&quot;./result/T_C/1.diff.img.RDATA&quot;) </span></span>
<span id="cb5-3"><a href="deg.html#cb5-3" tabindex="-1"></a><span class="co"># library(LZ)</span></span>
<span id="cb5-4"><a href="deg.html#cb5-4" tabindex="-1"></a><span class="fu">library</span>(ggpubr);<span class="fu">library</span>(ggrepel);<span class="fu">library</span>(ggsci);<span class="fu">library</span>(scales)</span>
<span id="cb5-5"><a href="deg.html#cb5-5" tabindex="-1"></a><span class="fu">library</span>(tidyverse);<span class="fu">library</span>(dplyr);<span class="fu">library</span>(pheatmap);<span class="fu">library</span>(RColorBrewer)</span>
<span id="cb5-6"><a href="deg.html#cb5-6" tabindex="-1"></a><span class="co"># 导入火山图需要的数据，即差异分析后的未筛选表格(我们也称这个对象为resdf,</span></span>
<span id="cb5-7"><a href="deg.html#cb5-7" tabindex="-1"></a><span class="co">#  resdf文件涵盖差异分析的所有结果信息，可以做后续所有基于差异分析或者基因列表</span></span>
<span id="cb5-8"><a href="deg.html#cb5-8" tabindex="-1"></a><span class="co">#  的所有分析，如果后续分析时使用其它数据，请按这个resdf的格式改数据，主要</span></span>
<span id="cb5-9"><a href="deg.html#cb5-9" tabindex="-1"></a><span class="co">#  就是把数据的列名改成和resdf的列名相同，即可用此包的函数分析画图)</span></span>
<span id="cb5-10"><a href="deg.html#cb5-10" tabindex="-1"></a><span class="co">#  即df_valcano &lt;- readxl::read_xlsx(&quot;xxx.xlsx&quot;, sheet = 1)</span></span>
<span id="cb5-11"><a href="deg.html#cb5-11" tabindex="-1"></a>df_valcano <span class="ot">&lt;-</span> all_father<span class="sc">$</span>DIFF.ALL</span>
<span id="cb5-12"><a href="deg.html#cb5-12" tabindex="-1"></a><span class="fu">names</span>(df_valcano) <span class="co"># 对应的列名必须为Gene, log2FC, PValue, FDR</span></span>
<span id="cb5-13"><a href="deg.html#cb5-13" tabindex="-1"></a><span class="co"># 差异分析阈值设定</span></span>
<span id="cb5-14"><a href="deg.html#cb5-14" tabindex="-1"></a>ffdr <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb5-15"><a href="deg.html#cb5-15" tabindex="-1"></a>fpval <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb5-16"><a href="deg.html#cb5-16" tabindex="-1"></a>flogfc <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb5-17"><a href="deg.html#cb5-17" tabindex="-1"></a><span class="co"># 模式设定</span></span>
<span id="cb5-18"><a href="deg.html#cb5-18" tabindex="-1"></a>filterc <span class="ot">&lt;-</span> <span class="st">&quot;fppadj&quot;</span> <span class="co"># pvalue, padj均考虑模式 (&quot;fpadj&quot;:仅考虑fdr值模式, &quot;other&quot;: 仅考虑p值模式)</span></span>
<span id="cb5-19"><a href="deg.html#cb5-19" tabindex="-1"></a><span class="co"># 设定需要标记的marker gene</span></span>
<span id="cb5-20"><a href="deg.html#cb5-20" tabindex="-1"></a>label_gene <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;TFRC&#39;</span>, <span class="st">&#39;ACSL1&#39;</span>, <span class="st">&#39;LPCAT3&#39;</span>, <span class="st">&#39;PCBP1&#39;</span>, <span class="st">&#39;FTH1&#39;</span>, <span class="st">&#39;SLC11A2&#39;</span>,</span>
<span id="cb5-21"><a href="deg.html#cb5-21" tabindex="-1"></a>                <span class="st">&#39;SLC39A8&#39;</span>, <span class="st">&#39;SAT1&#39;</span>, <span class="st">&#39;FTL&#39;</span>, <span class="st">&#39;GSS&#39;</span>)</span>
<span id="cb5-22"><a href="deg.html#cb5-22" tabindex="-1"></a><span class="co"># 查看想展示的基因在不在差异分析总表中</span></span>
<span id="cb5-23"><a href="deg.html#cb5-23" tabindex="-1"></a><span class="co"># label_gene %in% df_valcano$Gene %&gt;% all</span></span>
<span id="cb5-24"><a href="deg.html#cb5-24" tabindex="-1"></a><span class="co"># pic_data %&gt;% filter(Row.names %in% label_gene)</span></span>
<span id="cb5-25"><a href="deg.html#cb5-25" tabindex="-1"></a><span class="co"># 火山图数据预处理</span></span>
<span id="cb5-26"><a href="deg.html#cb5-26" tabindex="-1"></a>pic_data <span class="ot">&lt;-</span> <span class="fu">DEGp_prepareVolcano</span>(<span class="at">df_valcano =</span> df_valcano, <span class="at">filterc =</span> filterc)</span>
<span id="cb5-27"><a href="deg.html#cb5-27" tabindex="-1"></a><span class="co"># 火山图 无标记</span></span>
<span id="cb5-28"><a href="deg.html#cb5-28" tabindex="-1"></a><span class="fu">DEGp_Volcano</span>(<span class="at">result =</span> pic_data, <span class="at">logFC =</span> flogfc,</span>
<span id="cb5-29"><a href="deg.html#cb5-29" tabindex="-1"></a>             <span class="at">adj_P =</span> ffdr, <span class="at">label_geneset =</span> <span class="cn">NULL</span>)</span>
<span id="cb5-30"><a href="deg.html#cb5-30" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(outdirsub,<span class="st">&quot;/valcano.pdf&quot;</span>), <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">7</span>) <span class="co"># 保存</span></span>
<span id="cb5-31"><a href="deg.html#cb5-31" tabindex="-1"></a><span class="co"># 火山图 有标记</span></span>
<span id="cb5-32"><a href="deg.html#cb5-32" tabindex="-1"></a><span class="fu">DEGp_Volcano</span>(<span class="at">result =</span> pic_data, <span class="at">logFC =</span> flogfc, <span class="co"># log2(2)</span></span>
<span id="cb5-33"><a href="deg.html#cb5-33" tabindex="-1"></a>             <span class="at">adj_P =</span> ffdr, <span class="at">label_geneset =</span> label_gene) <span class="sc">%&gt;%</span></span>
<span id="cb5-34"><a href="deg.html#cb5-34" tabindex="-1"></a>  <span class="fu">ggplotGrob</span>() <span class="sc">%&gt;%</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>()</span>
<span id="cb5-35"><a href="deg.html#cb5-35" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(outdirsub, <span class="st">&quot;/valcano.mark.gene.pdf&quot;</span>), <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">7</span>) <span class="co"># 保存</span></span></code></pre></div>
</div>
<div id="热图" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> 热图<a href="deg.html#热图" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>On the way …</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="install.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="enrich.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ArronLZ/LZ/02-deg.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["LZdocument.pdf", "LZdocument.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
